<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="admin-title">Administra√ß√£o de Produtos</h1>
    <div class="d-flex gap-2">
      <button class="btn-outline-primary border-dark btn-sm" (click)="refreshProducts()">
        üîÑ Atualizar
      </button>
    </div>
  </div>

  <div class="row mb-4 d-flex align-items-center">
    <div class="col-md-6 d-flex align-items-center">
      <input type="text" class="form-control" placeholder="Buscar produtos..." [(ngModel)]="searchTerm">
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <select class="form-select" [(ngModel)]="selectedCategory">
        <option value="">Todas as Categorias</option>
        @for (category of categories(); track category) {
        <option [value]="category">{{ category | titlecase }}</option>
        }
      </select>
    </div>
    <div class="col-md-2 d-flex align-items-center justify-content-end">
      <div class="text-muted">
        {{ filteredProducts().length }} produto(s)
      </div>
    </div>
  </div>

  @if (loading()) {
  <div class="d-flex justify-content-center my-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>
  } @else if (error()) {
  <div class="alert alert-danger d-flex justify-content-between align-items-center">
    <span>{{ error() }}</span>
    <button class="btn btn-sm btn-outline-danger" (click)="refreshProducts()">
      Tentar Novamente
    </button>
  </div>
  } @else {
  @if (filteredProducts().length === 0) {
  <div class="text-center my-5">
    <h3>Nenhum produto encontrado</h3>
    <p>Tente ajustar os filtros de busca.</p>
  </div>
  } @else {
  <div class="card">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-dark">
          <tr>
            <th width="80">ID</th>
            <th width="100">Imagem</th>
            <th>T√≠tulo</th>
            <th width="100">Pre√ßo</th>
            <th width="150">Categoria</th>
            <th width="80">Avalia√ß√£o</th>
            <th width="100">A√ß√µes</th>
          </tr>
        </thead>
        <tbody class="table-dark">
          @for (product of filteredProducts(); track product.id) {
          <tr>
            <td>
              <span class="badge">{{ product.id }}</span>
            </td>
            <td>
              <img [src]="product.image" [alt]="product.title" class="product-image">
            </td>
            <td>
              <div class="product-title">{{ product.title }}</div>
              <div class="product-description">{{ product.description }}</div>
            </td>
            <td>
              <span class="fw-bold text-success">{{ product.price | currency: 'BRL' }}</span>
            </td>
            <td>
              <span class="badge badge-category">
                {{ product.category | titlecase }}
              </span>
            </td>
            <td>
              <div class="d-flex align-items-center gap-1">
                <small>‚≠ê {{ product.rating.rate }} </small>
                <small class="text-muted">({{ product.rating.count }})</small>
              </div>
            </td>
            <td>
              <div class="btn-group-vertical btn-group-sm">
                <button class="btn border-dark btn-sm mb-1" (click)="viewProduct(product.id)" title="Ver Detalhes">
                  üëÅÔ∏è
                </button>
                <button class="btn border-dark btn-sm" (click)="deleteProduct(product.id)"
                  [disabled]="deleting().has(product.id)" title="Deletar Produto">
                  @if (deleting().has(product.id)) {
                  <span class="spinner-border spinner-border-sm"></span>
                  } @else {
                  üóëÔ∏è
                  }
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-md-12">
      <div class="card stats-card">
        <div class="card-body">
          <h6>Estat√≠sticas R√°pidas:</h6>
          <div class="row text-center">
            <div class="col">
              <strong>{{ products().length }}</strong><br>
              <small>Total Produtos</small>
            </div>
            <div class="col">
              <strong>{{ categories().length }}</strong><br>
              <small>Categorias</small>
            </div>
            <div class="col">
              <strong>{{ averagePrice() | currency: 'BRL' }}</strong><br>
              <small>Pre√ßo M√©dio</small>
            </div>
            <div class="col">
              <strong>{{ averageRating().toFixed(1) }}‚≠ê</strong><br>
              <small>Avalia√ß√£o M√©dia</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  }
  }
</div>
